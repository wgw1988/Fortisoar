import requests
from .tipping_point_common import *
from connectors.core.connector import get_logger, ConnectorError
from .constants import LOGGER_NAME
logger = get_logger(LOGGER_NAME)


def get_rule(config, params):
    
    return True # 테스트용
    
    try:
        # 데이터 요청
        url = 'https://111.111.111.111/ipsProfileMgmt/exportProfile?profileName=MyProfile'
        request = urllib.request.Request(url)
        request.add_header("Content-Type", 'application/json;charset=UTF-8')
        request.add_header("X-SMS-API-KEY", config['apikey'])
        response = urllib.request.urlopen(request)
        
        # API 응답 체크
        handle_api_error(response)
        
        # 응답결과 리턴
        response_body = response.read()
        return json.loads(response_body.decode('utf-8'))
    
    except Exception as err:
        logger.error(str(err))
        raise ConnectorError(str(err))
    
    
    '''
    # tipping point sms
    
    Access to the SMS Web API requires that you authenticate by using HTTP authentication or the API key.

    • HTTP authentication: –u {username}:{password} curl -k -u {username}:{password} "https://<sms_server>/ipsProfileMgmt/ exportProfile?profileName=MyProfile"

    • API key: authentication mechanism that does not require a username and password. Use the API key as part of the header for HTTP requests. X-SMS-API-KEY: curl -k --header "X-SMS-API-KEY: " "https://<sms_server>/ipsProfileMgmt/ exportProfile?profileName=MyProfile"

    Errors The SMS web API returns one of the following HTTP status codes if the request is unsuccessful. Code Description 400 Bad request – malformed parameter or request. 401 Unauthorized – missing or incorrect credentials. 403 No web access capability. If you receive this message, check the user role capabilities, and enable the Access SMS Web Services capability. On the SMS, go to Admin > Authentication and Authorization > Roles > Edit > Capabilities > Admin > Access SMS Web Services. 404 Not found – invalid or nonexistent requested source. 412 Preconditioned fail – unexpected error. Check the SMS System Log. On the SMS, go to Admin > General > SMS System Log. 500 Internal server error – server-side exception. Check the SMS System Log. On the SMS, go to Admin > General > SMS System Log.

    Get current filter settings Retrieve current filter settings for a profile. The Current Filter Settings Request is a POST request, and requires you to provide an XML file that identifies the profile and the filter(s). When the SMS receives a current filter settings service request, it: • Validates the filter ID using the DV metadata.

    Example curl -X POST -k --header "X-SMS-API-KEY: " --form name=@getFilters.xml https://<sms_server>/ipsProfileMgmt/getFilters The following sample shows how the getFilters XML file is composed according to the schema. You must provide values for the profile name and at least one of the filter search terms: number, signature ID, policy ID, or name.
    '''
    
